name: Automatic Archive Sync to RpgArchive
# test
on:
  push:
    branches:
      - main # RpgPlugin의 main 브랜치에 푸시될 때 실행

jobs:
  sync_to_archive:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout RpgPlugin Repository (Full History)
        uses: actions/checkout@v4
        with:
          # 모든 브랜치와 태그 이력을 가져오기 위해 fetch-depth를 0으로 설정
          fetch-depth: 0 
          # 기본 GITHUB_TOKEN 대신, 아카이브 리포지토리에 푸시할 권한이 있는 ARCHIVE_TOKEN을 사용
          token: ${{ secrets.ARCHIVE_TOKEN }}

      - name: Configure Git for Mirror Push
        run: |
          # Git 커밋 주체 설정
          git config user.name "GitHub Actions"
          git config user.email "action@github.com"
          
          # 아카이브 리포지토리의 URL을 원격으로 추가 (Secret을 사용하여 인증)
          # [주의: {RpgArchive_Owner}를 실제 소유자 이름으로 변경하세요]
          git remote add archive-remote https://x-access-token:${{ secrets.ARCHIVE_TOKEN }}@github.com/YuThhh/RpgArchive.git
          
      - name: Execute Mirror Push to RpgArchive
        run: |
          # --mirror 옵션으로 모든 브랜치, 태그, 커밋 이력을 강제 동기화(덮어쓰기)합니다.
          # 이 작업은 RpgPlugin의 현재 상태를 RpgArchive에 그대로 반영합니다.
          git push archive-remote --mirror
